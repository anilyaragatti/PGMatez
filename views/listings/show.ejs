<% layout('layout/boilerplate') -%>

  <div>
    <a href="/listing/<%= listing._id %>/edit">
      <h3>edit</h3>
    </a>
  </div>

  <div>
    <form method="POST" action="/listing/<%= listing._id %>?_method=DELETE">
      <button type="submit">Delete</button>
    </form>
  </div>

  <div class="pg-info">

    <!-- HERO CARD & GALLERY -->
    <div class="pg-card">
      <div class="pg-slider">
        <div class="pg-slides">
          <% if (listing.images && listing.images.length> 0) { %>
            <% listing.images.forEach(img=> { %>
              <img src="<%= img %>" alt="PG Image">
              <% }) %>
                <% } else { %>
                  <img src="/images/placeholder.jpg" alt="No Image">
                  <% } %>
        </div>

        <% if (listing.images && listing.images.length> 1) { %>
          <div class="pg-dots">
            <% listing.images.forEach((_, i)=> { %>
              <span class="dot <%= i === 0 ? 'active' : '' %>"></span>
              <% }) %>
          </div>
          <% } %>
      </div>

      <div class="pg-card-body">
        <h2 class="pg-title">
          <%= listing.title %>
        </h2>
        <p class="pg-owner">
          <i class="fa-solid fa-user-circle"></i>
          Owned by: <strong>
            <%= listing.owner.name %>
          </strong>
        </p>

        <p class="pg-desc">
          <%= listing.description %>
        </p>

        <div class="pg-location">
          <span class="area"><i class="fa-solid fa-location-dot"></i>
            <%= listing.location.area %>
          </span>
          <span class="landmark">
            <%= listing.location.landmark %>
          </span>
        </div>
        <span class="pg-gender"><i class="fa-solid fa-restroom"></i>
          <%= listing.gender %> PG
        </span>
      </div>
    </div>


    <!-- PRICING CARD -->
    <div class="pg-section-card">
      <h3 class="section-title">Pricing</h3>

      <div class="price-grid">
        <div class="price-item">
          <span class="label">Monthly Rent</span>
          <span class="value">₹ <%= listing.pricing.rent.toLocaleString("en-IN") %></span>
        </div>
        <div class="price-item">
          <span class="label">Deposit</span>
          <span class="value">₹ <%= listing.pricing.deposit.toLocaleString("en-IN") %></span>
        </div>
      </div>

      <div class="sharing-list">
        <h4 class="detail-label" style="font-weight: 600; margin: 0 0 8px;">Sharing Options</h4>
        <% listing.pricing.sharing.forEach(s=> { %>
          <div class="detail-row">
            <span class="sharing-type">
              <%= s.type %> Sharing
            </span>
            <span class="sharing-price">₹ <%= s.price.toLocaleString("en-IN") %></span>
          </div>
          <% }) %>
      </div>
    </div>


    <!-- OVERVIEW CARD -->
    <div class="pg-section-card">
      <h3 class="section-title">Overview</h3>
      <div class="overview-list">
        <div class="detail-row">
          <span class="detail-label">Food</span>
          <span class="detail-value">
            <%= listing.overview.food %>
          </span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Gate Time</span>
          <span class="detail-value">
            <%= listing.overview.gateTime %>
          </span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Preferred For</span>
          <span class="detail-value">
            <%= listing.preferredFor && listing.preferredFor.length> 0
              ? listing.preferredFor.join(", ")
              : "Anyone" %>
          </span>
        </div>
      </div>
    </div>


    <!-- AMENITIES -->
    <div class="pg-section-card">
      <h3 class="section-title">Amenities</h3>
      <% if (listing.amenities && listing.amenities.length> 0) { %>
        <div class="amenities-grid">
          <% listing.amenities.forEach(item=> { %>
            <div class="amenity-item">
              <i class="fa-solid fa-check-circle"></i>
              <span>
                <%= item %>
              </span>
            </div>
            <% }) %>
        </div>
        <% } else { %>
          <p class="detail-label">No amenities information available</p>
          <% } %>
    </div>


    <!-- PG RULES -->
    <div class="pg-section-card">
      <h3 class="section-title">PG Rules</h3>
      <% if (listing.rules && listing.rules.length> 0) { %>
        <div class="rules-list">
          <% listing.rules.forEach(rule=> { %>
            <div class="rule-item">
              <i class="fa-solid fa-circle-exclamation"></i>
              <span class="rule-text">
                <%= rule %>
              </span>
            </div>
            <% }) %>
        </div>
        <% } else { %>
          <p class="detail-label">No specific rules mentioned</p>
          <% } %>
    </div>


    <!-- OWNER CONTACT -->
    <div class="pg-section-card">
      <h3 class="section-title">Contact Owner</h3>

      <div class="owner-card">
        <div class="owner-avatar">
          <i class="fa-solid fa-user"></i>
        </div>
        <div class="owner-details">
          <h4>
            <%= listing.owner.name %>
          </h4>
          <p>
            <%= listing.owner.phone %>
          </p>
        </div>
      </div>

      <div class="contact-actions">
        <a href="tel:<%= listing.owner.phone %>" class="btn call-btn">
          <i class="fa-solid fa-phone"></i> Call
        </a>
        <a href="https://wa.me/91<%= listing.owner.phone %>" target="_blank" class="btn whatsapp-btn">
          <i class="fa-brands fa-whatsapp"></i> WhatsApp
        </a>
      </div>
    </div>

  </div>


  <script>
    const slider = document.querySelector(".pg-slides");
    const dots = document.querySelectorAll(".dot");

    if (slider) {
      slider.addEventListener("scroll", () => {
        const index = Math.round(slider.scrollLeft / slider.clientWidth);
        dots.forEach((dot, i) => {
          dot.classList.toggle("active", i === index);
        });
      });
    }
  </script>